

<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>bonnie++ | Lingfei&#39;s Blog</title>
  <meta name="author" content="Lingfei Kong">
  
  <meta name="description" content="读书笔记，资料整理">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="bonnie++"/>
  <meta property="og:site_name" content="Lingfei&#39;s Blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon" type="image/x-ico">
  <link rel="alternate" href="http://kongll.github.io/atom.xml" title="Lingfei&#39;s Blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Ffe3814b5f53cc394a493cbeb2368f2af' type='text/javascript'%3E%3C/script%3E"));
</script>



</head>


<body>
  <header id="header" class="inner">
<div class="alignleft">
  <h1><a href="/">Lingfei&#39;s Blog</a></h1>
  <h2><a href="/">我要扼住命运的咽喉，决不能让命运使我屈服</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/categories/Technology">技术</a></li>
    
      <li><a href="/categories/essay">随笔</a></li>
    
      <li><a href="/archives">归档</a></li>
    
      <li><a href="/about">关于</a></li>
    
	<li> <a href="/atom.xml">RSS</a> </li>
<li> <a title="把这个链接拖到你的Chrome收藏夹工具栏中" href='javascript:(function() {
	function c() {
		var e = document.createElement("link");
		e.setAttribute("type", "text/css");
		e.setAttribute("rel", "stylesheet");
		e.setAttribute("href", f);
		e.setAttribute("class", l);
		document.body.appendChild(e)
	}
 
	function h() {
		var e = document.getElementsByClassName(l);
		for (var t = 0; t < e.length; t++) {
			document.body.removeChild(e[t])
		}
	}
 
	function p() {
		var e = document.createElement("div");
		e.setAttribute("class", a);
		document.body.appendChild(e);
		setTimeout(function() {
			document.body.removeChild(e)
		}, 100)
	}
 
	function d(e) {
		return {
			height : e.offsetHeight,
			width : e.offsetWidth
		}
	}
 
	function v(i) {
		var s = d(i);
		return s.height > e && s.height < n && s.width > t && s.width < r
	}
 
	function m(e) {
		var t = e;
		var n = 0;
		while (!!t) {
			n += t.offsetTop;
			t = t.offsetParent
		}
		return n
	}
 
	function g() {
		var e = document.documentElement;
		if (!!window.innerWidth) {
			return window.innerHeight
		} else if (e && !isNaN(e.clientHeight)) {
			return e.clientHeight
		}
		return 0
	}
 
	function y() {
		if (window.pageYOffset) {
			return window.pageYOffset
		}
		return Math.max(document.documentElement.scrollTop, document.body.scrollTop)
	}
 
	function E(e) {
		var t = m(e);
		return t >= w && t <= b + w
	}
 
	function S() {
		var e = document.createElement("audio");
		e.setAttribute("class", l);
		e.src = i;
		e.loop = false;
		e.addEventListener("canplay", function() {
			setTimeout(function() {
				x(k)
			}, 500);
			setTimeout(function() {
				N();
				p();
				for (var e = 0; e < O.length; e++) {
					T(O[e])
				}
			}, 15500)
		}, true);
		e.addEventListener("ended", function() {
			N();
			h()
		}, true);
		e.innerHTML = " <p>If you are reading this, it is because your browser does not support the audio element. We recommend that you get a new browser.</p> <p>";
		document.body.appendChild(e);
		e.play()
	}
 
	function x(e) {
		e.className += " " + s + " " + o
	}
 
	function T(e) {
		e.className += " " + s + " " + u[Math.floor(Math.random() * u.length)]
	}
 
	function N() {
		var e = document.getElementsByClassName(s);
		var t = new RegExp("\\b" + s + "\\b");
		for (var n = 0; n < e.length; ) {
			e[n].className = e[n].className.replace(t, "")
		}
	}
 
	var e = 30;
	var t = 30;
	var n = 350;
	var r = 350;
	var i = "//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake.mp3";
	var s = "mw-harlem_shake_me";
	var o = "im_first";
	var u = ["im_drunk", "im_baked", "im_trippin", "im_blown"];
	var a = "mw-strobe_light";
	var f = "//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake-style.css";
	var l = "mw_added_css";
	var b = g();
	var w = y();
	var C = document.getElementsByTagName("*");
	var k = null;
	for (var L = 0; L < C.length; L++) {
		var A = C[L];
		if (v(A)) {
			if (E(A)) {
				k = A;
				break
			}
		}
	}
	if (A === null) {
		console.warn("Could not find a node of the right size. Please try a different page.");
		return
	}
	c();
	S();
	var O = [];
	for (var L = 0; L < C.length; L++) {
		var A = C[L];
		if (v(A)) {
			O.push(A)
		}
	}
})()    '>High一下</a> </li>

  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-04-20T12:24:48.000Z"><a href="/2015/04/20/bonnie/">2015-04-20</a></time>
      
      
  
    <h1 class="title">bonnie++</h1>
  

    </header>
    <div class="entry">
      
        <h1 id="How_to_install_bonnie++">How to install bonnie++</h1><ol>
<li><p>Download bonnie++ tarball from <a href="http://www.coker.com.au/bonnie++/" target="_blank" rel="external">http://www.coker.com.au/bonnie++/</a></p>
</li>
<li><p>Extract and install it:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar -xvzf bonnie++-<span class="doctag">XXX.</span>tgz</span></span><br><span class="line"><span class="comment"># cd bonnie++-<span class="doctag">XXX</span></span></span><br><span class="line"><span class="comment"># make</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="Features_and_Functions">Features and Functions</h1><ul>
<li>Easy to use, a simple tool used to test your hard drive and file system performance.</li>
<li>Can test the following I/O operations:<ul>
<li>Sequential Output<ul>
<li>Per Chr</li>
<li>Block</li>
<li>Rewrite</li>
</ul>
</li>
<li>Sequential Input<ul>
<li>Per Chr</li>
<li>Block</li>
</ul>
</li>
<li>Random<ul>
<li>Seeks</li>
</ul>
</li>
<li>Sequential Create<ul>
<li>Create</li>
<li>Read</li>
<li>Delete</li>
</ul>
</li>
<li>Random Create<ul>
<li>Create</li>
<li>Read</li>
<li>Delete</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Bonnie++ is a program to test hard drives and file systems for performance or the lack therof. There are a many different types of file system operations which different applications use to different degrees. Bonnie++ tests some of them and for each test gives a result of the amount of work done per second and the percentage of CPU time this took. For performance results higher numbers are better, for CPU usage lower are better (NB a configuration scoring a performance result of 2000 and a  CPU result of 90% is better in terms of CPU use than a configuration delivering performance of 1000 and CPU usage of 60%).</p>
<p>There are two sections to the program’s operations. The first is to test the IO throughput in a fashion that is designed to simulate some types of database applications. The second is to test creation, reading, and deleting many small files in a fashion similar to the usage patterns of programs such as Squid or INN.</p>
<h1 id="How_to_use_bonnie++">How to use bonnie++</h1><p>Just issue the following command, it should be ok for most situations:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bonnie++ -d /testdir/ -m testname -u root -s $((2*$RAM_SIZE))</span></span><br></pre></td></tr></table></figure></p>
<p><strong>Note:</strong><br>If you test want to test hard drive, you must mount it to the value of <strong>-d</strong> option. Also make sure that the hard drive size is double RAM, or you will have to specify <strong>-r</strong> option.</p>
<p>If you want to reduce ‘++++’ you need to increase the test time either by increasing the value of <strong>-n</strong> or by increasing the value of <strong>-s</strong>.</p>
<h1 id="Results_analysis">Results analysis</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bonnie++ -d ./ -m testname -u root -s 40M -r 10M</span></span><br><span class="line">Using uid:<span class="number">0</span>, gid:<span class="number">0</span>.</span><br><span class="line">Writing with putc()...done</span><br><span class="line">Writing intelligently...done</span><br><span class="line">Rewriting...done</span><br><span class="line">Reading with getc()...done</span><br><span class="line">Reading intelligently...done</span><br><span class="line">start <span class="string">'em...done...done...done...</span><br><span class="line">Create files in sequential order...done.</span><br><span class="line">Stat files in sequential order...done.</span><br><span class="line">Delete files in sequential order...done.</span><br><span class="line">Create files in random order...done.</span><br><span class="line">Stat files in random order...done.</span><br><span class="line">Delete files in random order...done.</span><br><span class="line">Version 1.03e       ------Sequential Output------ --Sequential Input- --Random-</span><br><span class="line">                    -Per Chr- --Block-- -Rewrite- -Per Chr- --Block-- --Seeks--</span><br><span class="line">Machine        Size K/sec %CP K/sec %CP K/sec %CP K/sec %CP K/sec %CP  /sec %CP</span><br><span class="line">testname        40M 54715  99 +++++ +++ +++++ +++ 51914  99 +++++ +++ +++++ +++</span><br><span class="line">                    ------Sequential Create------ --------Random Create--------</span><br><span class="line">                    -Create-- --Read--- -Delete-- -Create-- --Read--- -Delete--</span><br><span class="line">              files  /sec %CP  /sec %CP  /sec %CP  /sec %CP  /sec %CP  /sec %CP</span><br><span class="line">                 16 15104  99 +++++ +++ +++++ +++ 15480  99 +++++ +++ 31050  95</span><br><span class="line">testname,40M,54715,99,+++++,+++,+++++,+++,51914,99,+++++,+++,+++++,+++,16,15104,99,+++++,+++,+++++,+++,15480,99,+++++,+++,31050,95</span></span><br></pre></td></tr></table></figure>
<p>The primary output is plain-text in 80 columns which is designed to fit well when pasted into email and which will work well with Braille displays.</p>
<p>The second type of output is CSV (Comma Seperated Values). This can easily be imported into any spread-sheet or database program. Also it have included the programs bon_csv2html and bon_csv2txt to convert CSV data to HTML and plain-ascii respectively:</p>
<ol>
<li><p>Select the last comma seperated line.</p>
</li>
<li><p>Run the following command to generate the html file:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'testname,40M,54715,99,+++++,+++,+++++,+++,51914,99,+++++,+++,+++++,+++,16,15104,99,+++++,+++,+++++,+++,15480,99,+++++,+++,31050,95'</span> | perl bon_csv2html &gt; results.html</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>For every test two numbers are reported, the amount of work done (higher numbers are better) and the percentage of CPU time taken to perform the work (lower numbers are better). If a test  completes in less than 500ms then the output will be displayed as “++++”. This is because such a test result can’t be calculated accurately due to rounding errors and I would rather display no result than a wrong result.</p>
<h1 id="The_main_parameters">The main parameters</h1><ul>
<li><strong>-d</strong> - the directory to use for the tests.</li>
<li><strong>-s</strong> - the size of the file(s) for IO performance measures in megabytes. If the size is greater than 1G then multiple files will be used to store the data, and each file will be up to 1G in size. This parameter may include the chunk size seperated from the size by a colon. The chunk-size is measured in bytes and must be a power of two from 256 to 1048576, the default is 8192. You can specify the size in giga-bytes or the chunk-size in kilo-bytes if you add g or k to the end of the number respectively.</li>
<li><strong>-r</strong> - RAM size in megabytes. If you specify this the other parameters will be checked to ensure they make sense for a machine of that much RAM. You should not need to do this in general use as it should be able to discover the RAM size. NB If you specify a size of 0 then all checks will be disabled…</li>
<li><strong>-b</strong> - no write buffering. fsync() after every write.</li>
<li><strong>-D</strong> - use direct IO (O_DIRECT) for the bulk IO tests.</li>
<li><strong>-n</strong> - the number of files for the file creation test. This is measured in multiples of 1024 files. This is because no-one will want to test less than 1024 files, and we need the extra space on braille displays.</li>
<li><strong>-x</strong> - number of test runs. This is useful if you want to perform more than one test. It will dump output continuously in CSV format until either the number of tests have been completed, or it is killed.</li>
<li><strong>-m</strong> - name of the machine - for display purposes only.</li>
<li><strong>-f</strong> - fast mode, skips per-char IO tests</li>
<li><strong>-u</strong> - user-id to use. When running as root specify the UID to use for the tests. It is not recommended to use root (since the occasion when a Bonnie++ bug wiped out someone’s system), so if you really want to run as root then use -u root. Also if you want to specify the group to run as then use the user:group format. If you specify a user by name but no group then the primary group of that user will be chosen. If you specify a user by number and no group then the group will be nogroup.</li>
<li><strong>-g</strong> - group-id to use. Same as using:group for the -u parameter, just a different way to specify it for compatibility with other programs.</li>
<li><strong>-q</strong> - quiet mode. If specified then some of the extra informational messages will be suppressed.</li>
</ul>
<h1 id="Reference">Reference</h1><ul>
<li><a href="http://www.coker.com.au/bonnie++/" target="_blank" rel="external">Bonnie++</a></li>
<li>man bonnie++</li>
<li><a href="http://archive09.linux.com/feature/139742" target="_blank" rel="external">Using Bonnie++ for filesystem performance benchmarking</a></li>
</ul>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/Technology/">Technology</a>
  </div>

        
<!-- Baidu Button BEGIN -->
<div id="bdshare" class="bdshare_t bds_tools_32 get-codes-bdshare">
<a class="bds_qzone"></a>
<a class="bds_tsina"></a>
<a class="bds_tqq"></a>
<a class="bds_renren"></a>
<a class="bds_t163"></a>
<span class="bds_more"></span>
<a class="shareCount"></a>
</div>
<script type="text/javascript" id="bdshare_js" data="type=tools&amp;uid=3326447" ></script>
<script type="text/javascript" id="bdshell_js"></script>
<script type="text/javascript">
document.getElementById("bdshell_js").src = "http://bdimg.share.baidu.com/static/js/shell_v2.js?cdnversion=" + Math.ceil(new Date()/3600000)
</script>
<!-- Baidu Button END -->      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">

<nav id="pagination" >
    
    <a href="/2015/04/21/dbench/" class="alignleft prev" >上一页</a>
    
    
    <a href="/2015/04/20/iozone/" class="alignright next" >下一页</a>
    
    <div class="clearfix"></div>
</nav>

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"孔令飞"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->  
</section>


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:konglf.github.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/Technology/Emacs/">Emacs</a><small>1</small></li>
  
    <li><a href="/categories/Technology/Keys/">Keys</a><small>2</small></li>
  
    <li><a href="/categories/Technology/Lex/">Lex</a><small>2</small></li>
  
    <li><a href="/categories/Technology/Linux/">Linux</a><small>1</small></li>
  
    <li><a href="/categories/essay/Linux/">Linux</a><small>1</small></li>
  
    <li><a href="/categories/Technology/Python/">Python</a><small>2</small></li>
  
    <li><a href="/categories/Technology/Shell/">Shell</a><small>1</small></li>
  
    <li><a href="/categories/Technology/">Technology</a><small>30</small></li>
  
    <li><a href="/categories/Technology/Xen/Virtualization/">Virtualization</a><small>1</small></li>
  
    <li><a href="/categories/Technology/Xen/">Xen</a><small>1</small></li>
  
    <li><a href="/categories/essay/">essay</a><small>3</small></li>
  
  </ul>
</div>


  <div class="widget tag">
<h3 class="title">简介</h3>
<ul class="entry">
<li>中文名：孔令飞</li>
<li>英文名：Alex</li>
<li>现状：Lenovo从事存储性能调优</li>
<li>QQ号：466701708</li>
<li>想要交友的朋友请<a href="http://konglf.github.io/about">联系我</a>！</li>
<li><a href="http://chenghongjie1.sinaapp.com/">I Love You!</a></li>
</ul>
</div>


  <iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=3768665395&verifier=bc944b64&dpc=1"></iframe>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 Lingfei Kong
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>


<a href="https://github.com/alex8866" target="_blank"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png" alt="Fork me on GitHub"></a>
